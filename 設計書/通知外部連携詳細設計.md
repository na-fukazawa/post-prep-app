# ライブ告知 半自動投稿アプリ 通知・外部連携詳細設計（v1）

## 1. 通知（ローカル通知）

### 1.1 方針

* 端末ローカル通知のみ（サーバー不要）
* 公開日時に通知を表示し、タップで該当告知を開く

### 1.2 仕組み

* Flutter Local Notifications を使用
* 通知IDは `announcements.notification_id` に保持
* 予約時に通知を登録、更新/削除時に再登録/キャンセル

### 1.3 通知文言

* タイトル: 告知タイトル
* 本文: 固定文言（例: 「投稿の時間です」）

### 1.4 通知タップ時の挙動

* アプリ起動 → 告知詳細画面（S-03）に遷移
* 通知ペイロードに `announcement_id` を埋め込む

### 1.5 端末再起動/アプリ更新

* 起動時に「予約済み」告知を再取得
* `publish_at` が未来のものを再登録

### 1.6 タイムゾーン

* 端末ローカルタイムゾーンを利用
* 予約時に epoch ms を保存

### 1.7 権限

* 初回起動時に通知許可をリクエスト
* 拒否時は設定画面で再案内

---

## 2. X（旧Twitter）連携

### 2.1 方針

* Web Intent で投稿作成画面を起動
* 本文 + URL を自動入力

### 2.2 起動URL

* `https://twitter.com/intent/tweet?text={TEXT}&url={URL}`

### 2.3 文字数

* Xの文字数制限に合わせ、表示上はカウントを表示
* 超過時は警告表示（保存は可能）

### 2.4 失敗時の扱い

* アプリ起動に失敗した場合は `status=failed` とし、再試行ボタンを表示
* 再試行で成功した場合は `scheduled` に戻す

---

## 3. Instagram 連携

### 3.1 方針

* 自動投稿は行わず、共有シートでアプリを開く
* 本文コピー + 画像共有で支援

### 3.2 共有フロー

* 本文はクリップボードにコピー
* 画像は共有シートを起動
* Instagram選択時はアプリ側で投稿画面へ

### 3.3 失敗時の扱い

* 共有起動に失敗した場合は `status=failed`
* 未インストールの場合はストア誘導または共有シートで代替

---

## 4. 共有処理（共通）

### 4.1 共有方式

* 画像は複数選択可能
* 共有前に画像を一時領域にコピーし、URIで共有

### 4.2 エラーハンドリング

* 共有権限が不足している場合は権限リクエスト
* 共有失敗時はトースト/ダイアログで通知

---

以上
